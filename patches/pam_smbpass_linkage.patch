diff -ur samba-3.0.0beta1.orig/debian/rules samba-3.0.0beta1/debian/rules
--- samba-3.0.0beta1.orig/debian/rules	2003-06-16 23:59:01.000000000 -0500
+++ samba-3.0.0beta1/debian/rules	2003-06-17 00:00:26.000000000 -0500
@@ -95,7 +95,8 @@
 build-stamp:
 	dh_testdir
 
-	$(MAKE) -C source all nsswitch/libnss_wins.so python_ext
+	$(MAKE) -C source all nsswitch/libnss_wins.so python_ext \
+		LDSHFLAGS="-shared -Wl,-z,defs -g -O2"
 
 	touch build-stamp
 
diff -ur samba-3.0.0beta1.orig/source/Makefile.in samba-3.0.0beta1/source/Makefile.in
--- samba-3.0.0beta1.orig/source/Makefile.in	2003-06-16 23:59:19.000000000 -0500
+++ samba-3.0.0beta1/source/Makefile.in	2003-06-17 00:13:50.000000000 -0500
@@ -578,9 +578,9 @@
 
 PAM_SMBPASS_OBJ_0 = pam_smbpass/pam_smb_auth.o pam_smbpass/pam_smb_passwd.o \
                pam_smbpass/pam_smb_acct.o pam_smbpass/support.o \
-               libsmb/smbencrypt.o libsmb/smbdes.o libsmb/nterr.o \
-               $(PARAM_OBJ) $(LIB_OBJ) $(PASSDB_OBJ) $(GROUPDB_OBJ) \
-               $(SECRETS_OBJ) $(UBIQX_OBJ) $(IDMAP_OBJ)
+               $(LIBSAMBA_OBJ) $(PARAM_OBJ) $(LIB_OBJ) $(PASSDB_OBJ) \
+               $(GROUPDB_OBJ) $(SECRETS_OBJ) $(UBIQX_OBJ) $(IDMAP_OBJ) \
+               $(SMBLDAP_OBJ)
 
 PAM_SMBPASS_PICOOBJ = $(PAM_SMBPASS_OBJ_0:.o=.po)
 
@@ -1079,7 +1079,8 @@
 
 bin/pam_smbpass.@SHLIBEXT@: $(PAM_SMBPASS_PICOOBJ)
 	@echo "Linking shared library $@"
-	@$(SHLD) $(LDSHFLAGS) -o $@ $(PAM_SMBPASS_PICOOBJ) -lpam $(DYNEXP) $(LIBS) -lc
+	@$(SHLD) $(LDSHFLAGS) -o $@ $(PAM_SMBPASS_PICOOBJ) -lpam $(DYNEXP) \
+		 $(PASSDBLIBS) $(LIBS) -lc
 
 bin/libmsrpc.a: $(LIBMSRPC_PICOBJ)
 	@-$(AR) -rc $@ $(LIBMSRPC_PICOBJ) 
