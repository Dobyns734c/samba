Index: samba/source3/smbd/nttrans.c
===================================================================
--- samba.orig/source3/smbd/nttrans.c
+++ samba/source3/smbd/nttrans.c
@@ -2264,7 +2264,7 @@ NTSTATUS smb_fsctl(struct files_struct *
 		if (!labels) {
 			*out_len = 16;
 		} else {
-			*out_len = 12 + labels_data_count + 4;
+			*out_len = 12 + labels_data_count;
 		}
 
 		if (max_out_len < *out_len) {
@@ -2274,7 +2274,7 @@ NTSTATUS smb_fsctl(struct files_struct *
 			return NT_STATUS_BUFFER_TOO_SMALL;
 		}
 
-		cur_pdata = talloc_array(ctx, char, *out_len);
+		cur_pdata = talloc_zero_array(ctx, char, *out_len);
 		if (cur_pdata == NULL) {
 			TALLOC_FREE(shadow_data);
 			return NT_STATUS_NO_MEMORY;
@@ -2291,7 +2291,7 @@ NTSTATUS smb_fsctl(struct files_struct *
 		}
 
 		/* needed_data_count 4 bytes */
-		SIVAL(cur_pdata, 8, labels_data_count + 4);
+		SIVAL(cur_pdata, 8, labels_data_count);
 
 		cur_pdata += 12;
 
