Goal: Interdomain trusts with Windows 2008 R2 DCs.

Fixes: #575951

Status wrt upstream: Fixed in 3.3 and 3.4.1

Author: GÃ¼nther Deschner <gd@samba.org>

Details:
 The Schannel verifier (aka NL_AUTH_SIGNATURE) structure (32 byte) sent from a
 W2k8r2 DC is passed in a buffer with the size of a NL_AUTH_SHA2_SIGNATURE (56
 byte). We should just ignore the remaining 12 zeroed bytes and proceed.

Index: lenny/source/include/rpc_dce.h
===================================================================
--- lenny.orig/source/include/rpc_dce.h
+++ lenny/source/include/rpc_dce.h
@@ -150,7 +150,7 @@
 };
 
 /* Maximum size of the signing data in a fragment. */
-#define RPC_MAX_SIGN_SIZE 0x20 /* 32 */
+#define RPC_MAX_SIGN_SIZE 0x38 /* 56 */
 
 /* Maximum PDU fragment size. */
 /* #define MAX_PDU_FRAG_LEN 0x1630		this is what wnt sets */
Index: lenny/source/rpc_client/cli_pipe.c
===================================================================
--- lenny.orig/source/rpc_client/cli_pipe.c
+++ lenny/source/rpc_client/cli_pipe.c
@@ -349,7 +349,7 @@
 		return NT_STATUS_OK;
 	}
 
-	if (auth_len != RPC_AUTH_SCHANNEL_SIGN_OR_SEAL_CHK_LEN) {
+	if (auth_len < RPC_AUTH_SCHANNEL_SIGN_OR_SEAL_CHK_LEN) {
 		DEBUG(0,("cli_pipe_verify_schannel: auth_len %u.\n", (unsigned int)auth_len ));
 		return NT_STATUS_INVALID_PARAMETER;
 	}
