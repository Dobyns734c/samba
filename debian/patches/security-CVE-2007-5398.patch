Index: samba-3.0.24/source/nmbd/nmbd_packets.c
===================================================================
--- samba-3.0.24.orig/source/nmbd/nmbd_packets.c
+++ samba-3.0.24/source/nmbd/nmbd_packets.c
@@ -963,6 +963,12 @@
 	nmb->answers->ttl      = ttl;
   
 	if (data && len) {
+		if (len < 0 || len > sizeof(nmb->answers->rdata)) {
+			DEBUG(5,("reply_netbios_packet: "
+				"invalid packet len (%d)\n",
+				len ));
+			return;
+		}
 		nmb->answers->rdlength = len;
 		memcpy(nmb->answers->rdata, data, len);
 	}
